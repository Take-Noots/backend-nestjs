<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        <%= title || 'Advertisements Management' %> - Noot Admin
    </title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.6.0/axios.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#667eea',
                        secondary: '#764ba2',
                        accent: '#f093fb',
                        success: '#10b981',
                        warning: '#f59e0b',
                        error: '#ef4444',
                        dark: '#1f2937',
                        light: '#f9fafb'
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-in-out',
                        'slide-in': 'slideIn 0.3s ease-out',
                        'bounce-in': 'bounceIn 0.6s ease-out',
                        'pulse-dot': 'pulse 2s infinite'
                    }
                }
            }
        }
    </script>
    <style>
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes slideIn {
            from { transform: translateX(-100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes bounceIn {
            0% { transform: scale(0.3); opacity: 0; }
            50% { transform: scale(1.05); }
            70% { transform: scale(0.9); }
            100% { transform: scale(1); opacity: 1; }
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        .sidebar-item {
            position: relative;
            overflow: hidden;
        }
        .sidebar-item:hover {
            transform: translateX(5px);
        }
        .sidebar-item.active::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: white;
        }
        .main-content {
            transition: margin-left 0.3s ease;
        }
        .sidebar {
            transition: transform 0.3s ease;
        }
        .sidebar-mobile-overlay {
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .sidebar-mobile-overlay.show {
            opacity: 1;
            visibility: visible;
        }
        @media (max-width: 1024px) {
            .sidebar {
                transform: translateX(-100%);
            }
            .sidebar.show {
                transform: translateX(0);
            }
        }
    </style>
</head>

<body class="bg-gray-50 min-h-screen">
    <!-- Mobile Sidebar Overlay -->
    <div id="sidebarOverlay" class="sidebar-mobile-overlay lg:hidden"></div>

    <!-- Sidebar -->
    <div id="sidebar" class="sidebar fixed inset-y-0 left-0 z-50 w-64 gradient-bg text-white">
        <div class="flex items-center justify-between h-16 px-4 border-b border-white/10">
            <div class="flex items-center space-x-3">
                <div class="w-10 h-10 rounded-xl bg-white/20 flex items-center justify-center">
                    <span class="text-2xl">ðŸŽµ</span>
                </div>
                <div>
                    <h1 class="text-xl font-bold">Noot Admin</h1>
                    <p class="text-xs text-white/70">Music Social Platform</p>
                </div>
            </div>
            <!-- Mobile Close Button -->
            <button id="closeSidebar" class="lg:hidden p-2 text-white/70 hover:text-white">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <nav class="mt-8 px-4 space-y-2">
            <a href="/admin" class="sidebar-item flex items-center px-4 py-3 text-sm font-medium rounded-lg hover:bg-white/10 transition-all relative">
                <i class="fas fa-home w-5 h-5 mr-3"></i>
                Dashboard
            </a>
            <a href="/admin/users" class="sidebar-item flex items-center px-4 py-3 text-sm font-medium rounded-lg hover:bg-white/10 transition-all relative">
                <i class="fas fa-users w-5 h-5 mr-3"></i>
                Users
            </a>
            <a href="/admin/posts" class="sidebar-item flex items-center px-4 py-3 text-sm font-medium rounded-lg hover:bg-white/10 transition-all relative">
                <i class="fas fa-newspaper w-5 h-5 mr-3"></i>
                Posts
            </a>
            <a href="/admin/reports" class="sidebar-item flex items-center px-4 py-3 text-sm font-medium rounded-lg hover:bg-white/10 transition-all relative">
                <i class="fas fa-flag w-5 h-5 mr-3"></i>
                Reports
            </a>
            <a href="/admin/advertisements" class="sidebar-item active flex items-center px-4 py-3 text-sm font-medium rounded-lg bg-white/10 relative">
                <i class="fas fa-ad w-5 h-5 mr-3"></i>
                Advertisements
                <% if (advertisements.filter(ad => ad.status === 0).length > 0) { %>
                    <span class="ml-auto bg-yellow-500 text-xs px-2 py-1 rounded-full animate-pulse-dot">
                        <%= advertisements.filter(ad => ad.status === 0).length %>
                    </span>
                <% } %>
            </a>
            <a href="/admin/fanbases" class="sidebar-item flex items-center px-4 py-3 text-sm font-medium rounded-lg hover:bg-white/10 transition-all relative">
                <i class="fas fa-heart w-5 h-5 mr-3"></i>
                Fanbases
            </a>
            <a href="/admin/analytics" class="sidebar-item flex items-center px-4 py-3 text-sm font-medium rounded-lg hover:bg-white/10 transition-all relative">
                <i class="fas fa-chart-bar w-5 h-5 mr-3"></i>
                Analytics
            </a>
            <a href="/admin/settings" class="sidebar-item flex items-center px-4 py-3 text-sm font-medium rounded-lg hover:bg-white/10 transition-all relative">
                <i class="fas fa-cog w-5 h-5 mr-3"></i>
                Settings
            </a>
        </nav>

        <div class="absolute bottom-4 left-4 right-4">
            <div class="glass-effect rounded-lg p-4">
                <div class="flex items-center space-x-3">
                    <div class="w-8 h-8 rounded-full bg-white/20 flex items-center justify-center">
                        <i class="fas fa-user text-sm"></i>
                    </div>
                    <div class="flex-1 min-w-0">
                        <% if (typeof user !== 'undefined' && user) { %>
                        <p class="text-sm font-medium text-white truncate"><%= user.username || user.email %></p>
                        <p class="text-xs text-white/70 truncate"><%= user.email %></p>
                        <% } else { %>
                        <p class="text-sm font-medium text-white truncate">Admin User</p>
                        <p class="text-xs text-white/70 truncate">admin@noot.com</p>
                        <% } %>
                    </div>
                </div>
                <form action="/admin/logout" method="POST" class="mt-3">
                    <button type="submit" class="w-full px-3 py-2 text-xs font-medium text-white bg-white/10 rounded-lg hover:bg-white/20 transition-colors">
                        <i class="fas fa-sign-out-alt mr-2"></i>
                        Logout
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content lg:ml-64">
        <!-- Top Bar -->
        <header class="bg-white shadow-sm border-b border-gray-200 sticky top-0 z-30">
            <div class="flex items-center justify-between px-4 lg:px-6 py-4">
                <div class="flex items-center space-x-4">
                    <!-- Mobile Menu Button -->
                    <button id="openSidebar" class="lg:hidden p-2 text-gray-600 hover:text-gray-900">
                        <i class="fas fa-bars text-xl"></i>
                    </button>
                    <h2 class="text-xl lg:text-2xl font-bold text-gray-900">Advertisements Management</h2>
                </div>

                <!-- Statistics -->
                <div class="flex items-center space-x-4">
                    <div class="flex space-x-2 text-sm">
                        <span class="bg-gray-100 text-gray-800 px-3 py-1 rounded-full">Total: <%= advertisements.length %></span>
                        <span class="bg-yellow-100 text-yellow-800 px-3 py-1 rounded-full">Pending: <%= advertisements.filter(ad => ad.status === 0).length %></span>
                        <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full">Approved: <%= advertisements.filter(ad => ad.status === 1).length %></span>
                        <span class="bg-red-100 text-red-800 px-3 py-1 rounded-full">Rejected: <%= advertisements.filter(ad => ad.status === 2).length %></span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content Area -->
        <main class="p-4 lg:p-6">
            <!-- Filter Tabs -->
            <div class="mb-6">
                <div class="border-b border-gray-200">
                    <nav class="-mb-px flex space-x-8">
                        <button onclick="showTab('all')" id="tab-all" class="tab-btn border-b-2 border-primary text-primary py-2 px-1 text-sm font-medium">
                            All Advertisements (<%= advertisements.length %>)
                        </button>
                        <button onclick="showTab('pending')" id="tab-pending" class="tab-btn border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 py-2 px-1 text-sm font-medium">
                            Pending (<%= advertisements.filter(ad => ad.status === 0).length %>)
                        </button>
                        <button onclick="showTab('approved')" id="tab-approved" class="tab-btn border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 py-2 px-1 text-sm font-medium">
                            Approved (<%= advertisements.filter(ad => ad.status === 1).length %>)
                        </button>
                        <button onclick="showTab('rejected')" id="tab-rejected" class="tab-btn border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 py-2 px-1 text-sm font-medium">
                            Rejected (<%= advertisements.filter(ad => ad.status === 2).length %>)
                        </button>
                    </nav>
                </div>
            </div>

            <!-- All Advertisements -->
            <div id="content-all" class="tab-content">
                <% if (advertisements.length === 0) { %>
                    <div class="text-center py-12">
                        <i class="fas fa-ad text-6xl text-gray-300 mb-4"></i>
                        <h3 class="text-lg font-medium text-gray-900 mb-2">No advertisements found</h3>
                        <p class="text-gray-500">Advertisements will appear here once users create them.</p>
                    </div>
                <% } else { %>
                    <div class="grid gap-4">
                        <% advertisements.forEach(function(ad) { %>
                            <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 card-hover">
                                <div class="flex items-start space-x-4">
                                    <!-- Advertisement Media -->
                                    <div class="flex-shrink-0">
                                        <% if (ad.image) { %>
                                            <img src="<%= ad.image %>" alt="Ad Image" class="w-24 h-24 object-cover rounded-lg">
                                        <% } else if (ad.video) { %>
                                            <video class="w-24 h-24 object-cover rounded-lg" controls>
                                                <source src="<%= ad.video %>" type="video/mp4">
                                            </video>
                                        <% } else { %>
                                            <div class="w-24 h-24 bg-gray-100 rounded-lg flex items-center justify-center">
                                                <i class="fas fa-ad text-gray-400 text-2xl"></i>
                                            </div>
                                        <% } %>
                                    </div>

                                    <!-- Advertisement Content -->
                                    <div class="flex-grow">
                                        <div class="flex items-start justify-between">
                                            <div class="flex-grow">
                                                <h3 class="text-lg font-semibold text-gray-900 mb-2"><%= ad.title %></h3>
                                                <p class="text-gray-600 mb-3"><%= ad.description.length > 100 ? ad.description.substring(0, 100) + '...' : ad.description %></p>

                                                <!-- Tags -->
                                                <div class="flex flex-wrap gap-2 mb-3">
                                                    <% if (ad.location) { %>
                                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                                                            <i class="fas fa-map-marker-alt mr-1"></i><%= ad.location %>
                                                        </span>
                                                    <% } %>
                                                    <% if (ad.genre) { %>
                                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800">
                                                            <i class="fas fa-tag mr-1"></i><%= ad.genre %>
                                                        </span>
                                                    <% } %>
                                                    <% if (ad.contactDetails) { %>
                                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                                            <i class="fas fa-phone mr-1"></i>Contact Available
                                                        </span>
                                                    <% } %>
                                                </div>

                                                <!-- Meta Info -->
                                                <div class="text-sm text-gray-500">
                                                    <span><i class="fas fa-calendar mr-1"></i><%= new Date(ad.createdAt).toLocaleDateString() %></span>
                                                    <% if (ad.reqViews > 0) { %>
                                                        <span class="ml-4"><i class="fas fa-eye mr-1"></i>Requested Views: <%= ad.reqViews %></span>
                                                    <% } %>
                                                </div>
                                            </div>

                                            <!-- Status and Actions -->
                                            <div class="flex flex-col items-end space-y-3">
                                                <!-- Status Badge -->
                                                <% if (ad.status === 0) { %>
                                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">
                                                        <i class="fas fa-clock mr-1"></i>Pending
                                                    </span>
                                                <% } else if (ad.status === 1) { %>
                                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                                        <i class="fas fa-check mr-1"></i>Approved
                                                    </span>
                                                <% } else { %>
                                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">
                                                        <i class="fas fa-times mr-1"></i>Rejected
                                                    </span>
                                                <% } %>

                                                <!-- Action Buttons -->
                                                <div class="flex flex-col space-y-2">
                                                    <button onclick="viewAdDetails('<%= ad._id %>')" class="inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-xs font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
                                                        <i class="fas fa-eye mr-1"></i>View Details
                                                    </button>

                                                    <% if (ad.status !== 1) { %>
                                                        <button onclick="approveAd('<%= ad._id %>')" class="inline-flex items-center px-3 py-2 border border-transparent shadow-sm text-xs font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
                                                            <i class="fas fa-check mr-1"></i>Approve
                                                        </button>
                                                    <% } %>

                                                    <% if (ad.status !== 2) { %>
                                                        <button onclick="rejectAd('<%= ad._id %>')" class="inline-flex items-center px-3 py-2 border border-transparent shadow-sm text-xs font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">
                                                            <i class="fas fa-times mr-1"></i>Reject
                                                        </button>
                                                    <% } %>

                                                    <button onclick="deleteAd('<%= ad._id %>')" class="inline-flex items-center px-3 py-2 border border-transparent shadow-sm text-xs font-medium rounded-md text-white bg-gray-600 hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500">
                                                        <i class="fas fa-trash mr-1"></i>Delete
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        <% }); %>
                    </div>
                <% } %>
            </div>

            <!-- Pending Advertisements -->
            <div id="content-pending" class="tab-content hidden">
                <div class="grid gap-4">
                    <% advertisements.filter(ad => ad.status === 0).forEach(function(ad) { %>
                        <div class="bg-white rounded-lg shadow-sm border border-yellow-200 p-6 card-hover">
                            <div class="flex items-start space-x-4">
                                <div class="flex-shrink-0">
                                    <% if (ad.image) { %>
                                        <img src="<%= ad.image %>" alt="Ad Image" class="w-24 h-24 object-cover rounded-lg">
                                    <% } else if (ad.video) { %>
                                        <video class="w-24 h-24 object-cover rounded-lg" controls>
                                            <source src="<%= ad.video %>" type="video/mp4">
                                        </video>
                                    <% } else { %>
                                        <div class="w-24 h-24 bg-gray-100 rounded-lg flex items-center justify-center">
                                            <i class="fas fa-ad text-gray-400 text-2xl"></i>
                                        </div>
                                    <% } %>
                                </div>
                                <div class="flex-grow">
                                    <h3 class="text-lg font-semibold text-gray-900 mb-2"><%= ad.title %></h3>
                                    <p class="text-gray-600 mb-3"><%= ad.description %></p>
                                    <div class="flex space-x-2">
                                        <button onclick="approveAd('<%= ad._id %>')" class="inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700">
                                            <i class="fas fa-check mr-2"></i>Approve
                                        </button>
                                        <button onclick="rejectAd('<%= ad._id %>')" class="inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-red-600 hover:bg-red-700">
                                            <i class="fas fa-times mr-2"></i>Reject
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    <% }); %>
                </div>
            </div>

            <!-- Approved Advertisements -->
            <div id="content-approved" class="tab-content hidden">
                <div class="grid gap-4">
                    <% advertisements.filter(ad => ad.status === 1).forEach(function(ad) { %>
                        <div class="bg-white rounded-lg shadow-sm border border-green-200 p-6 card-hover">
                            <div class="flex items-start space-x-4">
                                <div class="flex-shrink-0">
                                    <% if (ad.image) { %>
                                        <img src="<%= ad.image %>" alt="Ad Image" class="w-24 h-24 object-cover rounded-lg">
                                    <% } else { %>
                                        <div class="w-24 h-24 bg-gray-100 rounded-lg flex items-center justify-center">
                                            <i class="fas fa-ad text-gray-400 text-2xl"></i>
                                        </div>
                                    <% } %>
                                </div>
                                <div class="flex-grow">
                                    <h3 class="text-lg font-semibold text-gray-900 mb-2"><%= ad.title %></h3>
                                    <p class="text-gray-600 mb-3"><%= ad.description.length > 100 ? ad.description.substring(0, 100) + '...' : ad.description %></p>
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                        <i class="fas fa-check mr-1"></i>Approved
                                    </span>
                                </div>
                                <button onclick="rejectAd('<%= ad._id %>')" class="inline-flex items-center px-3 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-red-600 hover:bg-red-700">
                                    <i class="fas fa-times mr-2"></i>Reject
                                </button>
                            </div>
                        </div>
                    <% }); %>
                </div>
            </div>

            <!-- Rejected Advertisements -->
            <div id="content-rejected" class="tab-content hidden">
                <div class="grid gap-4">
                    <% advertisements.filter(ad => ad.status === 2).forEach(function(ad) { %>
                        <div class="bg-white rounded-lg shadow-sm border border-red-200 p-6 card-hover">
                            <div class="flex items-start space-x-4">
                                <div class="flex-shrink-0">
                                    <% if (ad.image) { %>
                                        <img src="<%= ad.image %>" alt="Ad Image" class="w-24 h-24 object-cover rounded-lg">
                                    <% } else { %>
                                        <div class="w-24 h-24 bg-gray-100 rounded-lg flex items-center justify-center">
                                            <i class="fas fa-ad text-gray-400 text-2xl"></i>
                                        </div>
                                    <% } %>
                                </div>
                                <div class="flex-grow">
                                    <h3 class="text-lg font-semibold text-gray-900 mb-2"><%= ad.title %></h3>
                                    <p class="text-gray-600 mb-3"><%= ad.description.length > 100 ? ad.description.substring(0, 100) + '...' : ad.description %></p>
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">
                                        <i class="fas fa-times mr-1"></i>Rejected
                                    </span>
                                </div>
                                <button onclick="approveAd('<%= ad._id %>')" class="inline-flex items-center px-3 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700">
                                    <i class="fas fa-check mr-2"></i>Approve
                                </button>
                            </div>
                        </div>
                    <% }); %>
                </div>
            </div>
        </main>
    </div>

    <!-- Advertisement Details Modal -->
    <div id="adDetailsModal" class="fixed inset-0 z-50 overflow-y-auto hidden">
        <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" onclick="closeModal()"></div>
            <div class="inline-block align-bottom bg-white rounded-lg px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-2xl sm:w-full sm:p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg leading-6 font-medium text-gray-900">Advertisement Details</h3>
                    <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                <div id="adDetailsContent">
                    <!-- Content will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Token refresh functionality to prevent sudden logouts
        let refreshInterval;

        function startTokenRefresh() {
            // Refresh token every 3.5 hours (before 4-hour expiry)
            refreshInterval = setInterval(async () => {
                try {
                    console.log('ðŸ”„ Attempting token refresh...');
                    const response = await fetch('/admin/refresh-token', {
                        method: 'POST',
                        credentials: 'include'
                    });

                    if (response.ok) {
                        console.log('âœ… Token refreshed successfully');
                    } else {
                        console.log('âŒ Token refresh failed, redirecting to login');
                        window.location.href = '/admin/login';
                    }
                } catch (error) {
                    console.error('âŒ Token refresh error:', error);
                    window.location.href = '/admin/login';
                }
            }, 3.5 * 60 * 60 * 1000); // 3.5 hours
        }

        function stopTokenRefresh() {
            if (refreshInterval) {
                clearInterval(refreshInterval);
            }
        }

        // Start token refresh when page loads
        document.addEventListener('DOMContentLoaded', function() {
            startTokenRefresh();

            // Stop refresh when page unloads
            window.addEventListener('beforeunload', stopTokenRefresh);
        });

        // Tab functionality
        function showTab(tabName) {
            // Hide all tab contents
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(content => content.classList.add('hidden'));

            // Remove active state from all tabs
            const tabBtns = document.querySelectorAll('.tab-btn');
            tabBtns.forEach(btn => {
                btn.classList.remove('border-primary', 'text-primary');
                btn.classList.add('border-transparent', 'text-gray-500');
            });

            // Show selected tab content
            document.getElementById('content-' + tabName).classList.remove('hidden');

            // Add active state to selected tab
            const activeTab = document.getElementById('tab-' + tabName);
            activeTab.classList.remove('border-transparent', 'text-gray-500');
            activeTab.classList.add('border-primary', 'text-primary');
        }

        // Advertisement actions
        function approveAd(adId) {
            if (confirm('Are you sure you want to approve this advertisement?')) {
                fetch('/admin/api/advertisements/' + adId + '/approve', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        location.reload();
                    } else {
                        alert('Error approving advertisement: ' + (data.message || 'Unknown error'));
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Error approving advertisement: ' + error.message);
                });
            }
        }

        function rejectAd(adId) {
            if (confirm('Are you sure you want to reject this advertisement?')) {
                fetch('/admin/api/advertisements/' + adId + '/reject', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        location.reload();
                    } else {
                        alert('Error rejecting advertisement: ' + (data.message || 'Unknown error'));
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Error rejecting advertisement: ' + error.message);
                });
            }
        }

        function deleteAd(adId) {
            if (confirm('Are you sure you want to permanently delete this advertisement? This action cannot be undone.')) {
                fetch('/admin/api/advertisements/' + adId + '/delete', {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        location.reload();
                    } else {
                        alert('Error deleting advertisement: ' + (data.message || 'Unknown error'));
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Error deleting advertisement: ' + error.message);
                });
            }
        }

        function viewAdDetails(adId) {
            fetch('/admin/api/advertisements/' + adId)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const ad = data.advertisement;
                        const content = `
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    ${ad.image ? '<img src="' + ad.image + '" class="w-full h-48 object-cover rounded-lg" alt="Ad Image">' :
                                      ad.video ? '<video controls class="w-full h-48 object-cover rounded-lg"><source src="' + ad.video + '" type="video/mp4"></video>' :
                                      '<div class="w-full h-48 bg-gray-100 rounded-lg flex items-center justify-content-center"><i class="fas fa-ad text-gray-400 text-4xl"></i></div>'}
                                </div>
                                <div class="space-y-4">
                                    <div>
                                        <h4 class="font-semibold text-gray-900">${ad.title}</h4>
                                        <p class="text-gray-600 mt-1">${ad.description}</p>
                                    </div>

                                    <div class="space-y-2">
                                        ${ad.location ? '<div class="flex items-center text-sm text-gray-500"><i class="fas fa-map-marker-alt w-4 mr-2"></i>' + ad.location + '</div>' : ''}
                                        ${ad.genre ? '<div class="flex items-center text-sm text-gray-500"><i class="fas fa-tag w-4 mr-2"></i>' + ad.genre + '</div>' : ''}
                                        ${ad.contactDetails ? '<div class="flex items-center text-sm text-gray-500"><i class="fas fa-phone w-4 mr-2"></i>' + ad.contactDetails + '</div>' : ''}
                                        ${ad.hashtags ? '<div class="text-sm text-gray-500"><strong>Hashtags:</strong> ' + ad.hashtags + '</div>' : ''}
                                        ${ad.keywords ? '<div class="text-sm text-gray-500"><strong>Keywords:</strong> ' + ad.keywords + '</div>' : ''}
                                    </div>

                                    <div class="border-t pt-4">
                                        <div class="text-sm text-gray-500">
                                            <div><strong>Created:</strong> ${new Date(ad.createdAt).toLocaleDateString()}</div>
                                            <div><strong>Status:</strong>
                                                ${ad.status === 0 ? '<span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">Pending</span>' :
                                                  ad.status === 1 ? '<span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">Approved</span>' :
                                                  '<span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800">Rejected</span>'}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `;
                        document.getElementById('adDetailsContent').innerHTML = content;
                        document.getElementById('adDetailsModal').classList.remove('hidden');
                    } else {
                        alert('Error loading advertisement details: ' + (data.message || 'Unknown error'));
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Error loading advertisement details: ' + error.message);
                });
        }

        function closeModal() {
            document.getElementById('adDetailsModal').classList.add('hidden');
        }

        // Mobile sidebar functionality
        document.getElementById('openSidebar').addEventListener('click', function() {
            document.getElementById('sidebar').classList.add('show');
            document.getElementById('sidebarOverlay').classList.add('show');
        });

        document.getElementById('closeSidebar').addEventListener('click', function() {
            document.getElementById('sidebar').classList.remove('show');
            document.getElementById('sidebarOverlay').classList.remove('show');
        });

        document.getElementById('sidebarOverlay').addEventListener('click', function() {
            document.getElementById('sidebar').classList.remove('show');
            document.getElementById('sidebarOverlay').classList.remove('show');
        });
    </script>
</body>
</html>